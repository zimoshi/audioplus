class AudioPlus extends HTMLElement{static get observedAttributes(){return["src"]}constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render(),this.init()}attributeChangedCallback(t,e,n){"src"===t&&this.audio&&(this.audio.src=n||"",this.buildWaveform())}render(){this.shadowRoot.innerHTML='\n<style>\n:host {\ndisplay: inline-block;\nfont-family: system-ui, sans-serif;\n}\n.player {\ndisplay: flex;\nalign-items: center;\ngap: 12px;\nbackground: #111;\npadding: 12px 16px;\nborder-radius: 16px;\ncolor: white;\nmax-width: 480px;\nposition: relative;\nuser-select: none;\n}\nbutton {\nbackground: none;\nborder: none;\ncolor: white;\nfont-size: 18px;\ncursor: pointer;\n}\ncanvas {\nflex: 1;\nheight: 48px;\ncursor: pointer;\n}\n.menu {\nposition: fixed;\ndisplay: none;\nbackground: #1a1a1a;\nborder-radius: 8px;\npadding: 6px 0;\nmin-width: 120px;\nbox-shadow: 0 8px 24px rgba(0,0,0,.5);\nz-index: 9999;\n}\n.menu div {\npadding: 8px 14px;\ncursor: pointer;\nfont-size: 14px;\ncolor: #fff; /* ← required */\n}\n.menu div:hover {\nbackground: #2a2a2a;\n}\n.menu div.active::after {\ncontent: " ✓";\nfloat: right;\ncolor: #22c55e;\n}\n</style>\n\n<div class="player">\n<button id="play">▶</button>\n<canvas id="wave"></canvas>\n</div>\n\n<div id="menu" class="menu">\n<span style="color: #fff; text-align: center; width: 100%; display: block;">Playback Speed</span>\n<hr />\n<div data-speed="0.1">0.1×</div>\n<div data-speed="0.25">0.25×</div>\n<div data-speed="0.5">0.5×</div>\n<div data-speed="0.75">0.75×</div>\n<hr />\n<div data-speed="1">1×</div>\n<div data-speed="2">2×</div>\n<div data-speed="3">3×</div>\n<div data-speed="4">4×</div>\n<div data-speed="5">5×</div>\n<hr />\n<span style="color: #fff; text-align: center; width: 100%; display: block;">Other</span>\n<hr />\n<div data-loop>Loop</div>\n</div>\n\n<audio></audio>\n'}init(){const t=this.shadowRoot;this.audio=t.querySelector("audio"),this.canvas=t.querySelector("#wave"),this.ctx=this.canvas.getContext("2d"),this.playBtn=t.querySelector("#play"),this.menu=t.querySelector("#menu"),this.audio.src=this.getAttribute("src")||"",this.audio.preload="metadata",this.resizeCanvas(),this.bindControls(),this.buildWaveform(),this.draw()}resizeCanvas(){const t=this.canvas.getBoundingClientRect(),e=window.devicePixelRatio||1;this.canvas.width=t.width*e,this.canvas.height=t.height*e,this.ctx.setTransform(e,0,0,e,0,0)}bindControls(){this.playBtn.onclick=()=>{this.audio.paused?(this.audio.play(),this.playBtn.textContent="⏸"):(this.audio.pause(),this.playBtn.textContent="▶")},this.canvas.onclick=t=>{const e=this.canvas.getBoundingClientRect(),n=t.clientX-e.left;this.audio.currentTime=n/this.canvas.width*this.audio.duration},this.canvas.addEventListener("contextmenu",t=>{t.preventDefault(),t.stopPropagation(),this.openMenu(t.clientX,t.clientY)}),this.menu.addEventListener("click",t=>{const e=t.target.closest("[data-speed]"),n=t.target.closest("[data-loop]");if(e){const t=parseFloat(e.dataset.speed);this.audio.playbackRate=t,this.updateActiveSpeed(t),this.closeMenu()}n&&(this.audio.loop=!this.audio.loop,n.classList.toggle("active",this.audio.loop)),this.menu.querySelector("[data-loop]").classList.toggle("active",this.audio.loop)}),document.addEventListener("click",()=>this.closeMenu()),this.updateActiveSpeed(1)}openMenu(t,e){this.menu.style.display="block",this.menu.style.left=`${t}px`,this.menu.style.top=`${e}px`}closeMenu(){this.menu.style.display="none"}updateActiveSpeed(t){this.menu.querySelectorAll("[data-speed]").forEach(e=>{e.classList.toggle("active",parseFloat(e.dataset.speed)===t)})}async buildWaveform(){if(!this.audio.src)return;const t=await fetch(this.audio.src),e=await t.arrayBuffer(),n=new AudioContext,i=(await n.decodeAudioData(e)).getChannelData(0),a=this.canvas.width,s=Math.floor(i.length/a);let o=[];for(let t=0;t<a;t++){let e=0;for(let n=0;n<s;n++){const a=i[t*s+n]||0;e+=a*a}o.push(Math.sqrt(e/s))}const d=Math.max(...o)||1;this.peaks=o.map(t=>Math.pow(t/d,.6))}draw(){if(requestAnimationFrame(()=>this.draw()),!this.peaks)return;const{ctx:t,canvas:e,audio:n}=this;t.clearRect(0,0,e.width,e.height);const i=e.height/2,a=n.currentTime/n.duration||0;this.peaks.forEach((e,n)=>{const s=e*i;t.fillStyle=n/this.peaks.length<a?"#22c55e":"#14532d",t.fillRect(n,i-s,1,2*s)})}}customElements.define("audio-plus",AudioPlus),(()=>{if(window.__AUDIOPLUS_BANNER__)return;window.__AUDIOPLUS_BANNER__=!0,console.groupCollapsed("%c AudioPlus ","\nbackground: #7dd3fc;\ncolor: #0f172a;\npadding: 6px 10px;\nborder-radius: 6px;\nfont-weight: 600;\nfont-family: system-ui, sans-serif;\n");["   ██    █","  █ █     █"," █  █  █   █","█   █  █   █"," █  █  █   █","  █ █     █","   ██    █"].forEach(t=>console.log("%c"+t,"font-family:monospace;color:#0f172a;background:#7dd3fc;line-height:1")),console.log("%cThis site uses AudioPlus.","color:#0f172a;font-weight:500;font-family:system-ui,sans-serif;"),console.log("%cWant to use it too? Try here!","color:#2563eb;font-family:system-ui,sans-serif;"),console.log("%chttps://example.com/docs","color:#16a34a;text-decoration:underline;font-family:system-ui,sans-serif;"),console.groupEnd()})();